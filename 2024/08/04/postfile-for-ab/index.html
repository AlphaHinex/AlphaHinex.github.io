
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>构造 ApacheBench 可用的 postfile - Alpha Hinex&#39;s Blog</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Java, JavaScript, Spring, Html5, NoSQL, Docker, DevOps,Apache Bench, ab, test, postfile, putfile, media-type, multipart/form-data, RFC 7578, RFC 2046, CRLF, boundary, Content-Disposition, form-data, filename"> 
    <meta name="description" content="摘要在 Web 开发过程中，文件上传功能是常见的需求。对于开发者而言，确保上传功能的稳定性和性能至关重要。
本文将带你了解如何使用ApacheBench性能测试工具对文件上传功能进行性能测试，特别是,"> 
    <meta name="author" content="Alpha Hinex"> 

    <meta name="msvalidate.01" content="D769824B4D44C14A4C777A6EC4E898FC"> 
    <meta name="baidu-site-verification" content="TimiEK4Y9V"> 
    <meta name="google-site-verification" content="B-WME81HWSnMIkZZxcxv7bVI6yjbpAFKvifi2X-EkzQ"> 

    <link rel="alternative" href="atom.xml" title="Alpha Hinex&#39;s Blog" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link href="https://fonts.loli.net/css?family=Roboto+Mono|Rubik&display=swap" rel="stylesheet">
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">

    
<link rel="stylesheet" href="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/animate.css/3.7.2/animate.min.css">

    
<link rel="stylesheet" href="/css/share.min.css">

    
<link rel="stylesheet" href="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/codemirror.min.css">

    
<link rel="stylesheet" href="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/theme/dracula.css">

    
<link rel="stylesheet" href="/css/obsidian.css">

    
<link rel="stylesheet" href="/css/ball-atom.min.css">

<meta name="generator" content="Hexo 4.2.1"></head>


<body class="loading">
    <div class="loader">
        <div class="la-ball-atom la-2x">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <span id="config-title" style="display:none">Alpha Hinex&#39;s Blog</span>
    <div id="loader"></div>
    <div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" class="icon-home" src="/img/favicon.png" alt="" data-url="https://AlphaHinex.github.io">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">构造 ApacheBench 可用的 postfile</h3>
        <div class="social">
            <!--        <div class="like-icon">-->
            <!--            <a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
            <!--        </div>-->
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
            animation-delay: 600ms;
            animation-duration: 1.2s;
            background-image: 
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(/contents/covers/postfile-for-ab.png);">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                <a href="/categories/Test"><b>「
                    </b>TEST<b> 」</b></a>
                
                八月 04, 2024
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/2024/08/04/postfile-for-ab/" title="构造 ApacheBench 可用的 postfile" class="">构造 ApacheBench 可用的 postfile</a>
            </h3>
            
            <p class="post-count animated fadeInDown">
                
                <span>
                    <b class="iconfont icon-text2"></b> <i>文章字数</i>
                    11k
                </span>
                
                
                <span>
                    <b class="iconfont icon-timer__s"></b> <i>阅读约需</i>
                    10 mins.
                </span>
                
                
                
                <span id="busuanzi_page_pv_container" style="display: flex;">
                    <b class="iconfont icon-read"></b> <i>阅读次数</i>
                    <span id="busuanzi_value_page_pv"></span>
                </span>
                
            </p>
            
            
            <ul class="animated fadeInDown post-tags-list" itemprop="keywords"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>在 <code>Web</code> 开发过程中，文件上传功能是常见的需求。对于开发者而言，确保上传功能的稳定性和性能至关重要。</p>
<p>本文将带你了解如何使用<code>ApacheBench</code>性能测试工具对文件上传功能进行性能测试，特别是如何按照规范构造上传文件的请求体，以便评估和提高服务器在高并发情况下的处理能力。</p>
<h2 id="ApacheBench-简介"><a href="#ApacheBench-简介" class="headerlink" title="ApacheBench 简介"></a>ApacheBench 简介</h2><p><code>ApacheBench</code>（简称<code>ab</code>）是 <code>Apache</code> 服务器自带的一个性能测试工具，它能够模拟多用户并发请求，从而评估服务器在高负载下的性能表现。若系统中未安装 <code>Apache</code> 服务器，可前往 <a href="https://httpd.apache.org/" target="_blank" rel="noopener">Apache 官网</a>下载和安装。更多关于 ApacheBench 的信息，请参考：<a href="https://mp.weixin.qq.com/s/5lqaOphTwsWhGHT-VSH0Tg" target="_blank" rel="noopener">ApacheBench 简介</a>。</p>
<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><p>假设有一个文件上传 <code>POST</code> 接口 <code>http://localhost:8080/upload</code> ，在请求体中接受 <code>key</code> 为 <code>file</code> 的文件，并返回上传的文件名和文件大小：</p>
<p><img src="/contents/covers/postfile-for-ab.png" alt=""></p>
<p>通过 <code>Postman</code> 等工具，我们可以直观地看到上传文件的请求内容：</p>
<pre><code class="text">POST /upload HTTP/1.1
Host: localhost:8080
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Length: 204

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;/C:/Users/admin/Desktop/test.jpg&quot;
Content-Type: image/jpeg

(data)
------WebKitFormBoundary7MA4YWxkTrZu0gW--</code></pre>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>当需要使用 <code>ApacheBench</code> 测试上传文件的 <code>POST</code> 接口时，<code>ab -h</code> 中只写到了通过 <code>-p</code> 参数指定 <code>postfile</code>：</p>
<blockquote>
<p>-p postfile     File containing data to POST. Remember also to set -T</p>
</blockquote>
<p>那么这个 <code>postfile</code> 中包含哪些内容呢？应该如何构造一个 <code>ApacheBench</code> 可用的 <code>postfile</code> 呢？</p>
<h2 id="有关-multipart-form-data-的规范"><a href="#有关-multipart-form-data-的规范" class="headerlink" title="有关 multipart/form-data 的规范"></a>有关 <code>multipart/form-data</code> 的规范</h2><p><a href="https://www.rfc-editor.org/rfc/rfc7578#section-4" target="_blank" rel="noopener">RFC 7578 第4节</a> 中关于 <code>multipart/form-data</code> 的定义提到：<code>multipart/form-data</code> 遵循 <a href="https://www.rfc-editor.org/rfc/rfc2046#section-5.1" target="_blank" rel="noopener">RFC 2046 第 5.1 节</a> 中定义的多部分 <code>MIME</code> 数据流结构，并有一些变化，大致的结构要求如下：</p>
<ol>
<li>请求头必须包含 <code>Content-Type: multipart/form-data; boundary=边界分隔符</code>；</li>
<li>多部分文件需要组合成一个单个的请求体，<code>边界分隔符</code> 字符串需保证在整个请求体内唯一，不会出现在分割行以外的其他部分；</li>
<li>请求体必须包含一个或多个部分，每部分一个实体（如：文件）；</li>
<li>各部分使用 <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CRLF" target="_blank" rel="noopener">CRLF</a> +<code>--</code> +<code>边界分隔符</code>作为一个<code>边界分割行</code>进行分隔，最后一部分后面使用 <code>边界分隔行</code> +<code>--</code>表示结束；换行符均需使用 CRLF（即 <code>\r\n</code>，即使在非 Windows 环境中）；</li>
<li>每部分在边界分隔行之间，又由三部分组成：头区域、空白行、内容区域；</li>
<li>每部分头区域必须包含 <code>Content-Disposition</code>  头字段，类型为 <code>form-data</code>；同时必须包含 <code>name</code> 参数，值为 <code>form</code> 中的原始字段名；当内容区域表示的是文件时，还应该提供 <code>filename</code> 参数。</li>
</ol>
<p>更详细的内容可参考上面引用的 <code>RFC</code> 规范文档。</p>
<h2 id="构造-postfile"><a href="#构造-postfile" class="headerlink" title="构造 postfile"></a>构造 postfile</h2><p>下面依照规范中格式要求，构造一个只发送一个文件的 <code>postfile</code>。</p>
<h3 id="1-准备-postfile-文件"><a href="#1-准备-postfile-文件" class="headerlink" title="1. 准备 postfile 文件"></a>1. 准备 postfile 文件</h3><ul>
<li>准备要上传的文件：如：<code>test.jpg</code>；</li>
<li>新建一个文本文件，命名为<code>postfile.txt</code>。</li>
</ul>
<h3 id="2-确定边界分隔符"><a href="#2-确定边界分隔符" class="headerlink" title="2. 确定边界分隔符"></a>2. 确定边界分隔符</h3><p>选择一个不会在文件内容中出现的字符串作为边界分隔符，例如：<code>----WebKitFormBoundary7MA4YWxkTrZu0gW</code>。</p>
<h3 id="3-编写-postfile-头区域及空白行"><a href="#3-编写-postfile-头区域及空白行" class="headerlink" title="3. 编写 postfile 头区域及空白行"></a>3. 编写 postfile 头区域及空白行</h3><p>在 <code>postfile.txt</code> 中写入以下内容，这些内容构成了请求体的头部信息，其中 <code>name</code> 应该与服务器端接收的字段名一致，<code>filename</code> 是要上传的文件的名称。</p>
<pre><code class="text">------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test.jpg&quot;
Content-Type: image/jpeg
</code></pre>
<blockquote>
<p>依据规范描述，Content-Type 头字段非必要。</p>
</blockquote>
<p><strong>此处需注意：</strong></p>
<p>因为规范要求使用<code>CRLF</code>作为换行符，在<code>非 Windows</code> 环境中，不能直接使用文本编辑器输入上面内容，可以按如下方式通过命令构造此部分内容：</p>
<pre><code class="Bash">$ echo -e &#39;------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test.jpg&quot;\r\nContent-Type: image/jpeg\r\n\r&#39; &gt; postfile.txt</code></pre>
<blockquote>
<p>通过 <code>&gt;</code>、<code>&gt;&gt;</code>向文件中添加内容时，会自动在最后追加一个 LR（<code>\n</code>），所以省略最后一个 <code>\n</code>。</p>
</blockquote>
<p>使用 <code>cat -e</code> 可验证换行符，每行结尾是 <code>^M$</code> 代表 <code>CRLF</code>换行符：</p>
<pre><code class="Bash">$ cat -e postfile.txt
------WebKitFormBoundary7MA4YWxkTrZu0gW^M$
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test.jpg&quot;^M$
Content-Type: image/jpeg^M$
^M$</code></pre>
<h3 id="4-添加文件内容至-postfile-内容区域"><a href="#4-添加文件内容至-postfile-内容区域" class="headerlink" title="4. 添加文件内容至 postfile 内容区域"></a>4. 添加文件内容至 postfile 内容区域</h3><p>由于文件内容通常是二进制数据，不能直接在文本编辑器中粘贴，可使用 <code>cat</code> 命令将文件内容追加至 <code>postfile</code> 中：</p>
<pre><code class="Bash"># 将 test.jpg 文件内容追加到 postfile.txt
$ cat test.jpg &gt;&gt; postfile.txt</code></pre>
<blockquote>
<p>Windows 系统中可在 <code>git bash</code> 中使用 <code>cat</code> 命令。</p>
</blockquote>
<blockquote>
<p><a href="https://gist.github.com/chiller/dec373004894e9c9bb38ac647c7ccfa8" target="_blank" rel="noopener">Benchmarking file uploads</a> 中以 base64 值作为文件数据内容进行传输的方式能够正常调用接口，但实测服务端接收到的数据内容依旧是 base64 的内容，并不是文件原始内容。故此处直接使用 <code>cat</code> 将文件原始数据内容直接追加到 <code>postfile</code> 中。</p>
</blockquote>
<h3 id="5-添加结束标记"><a href="#5-添加结束标记" class="headerlink" title="5. 添加结束标记"></a>5. 添加结束标记</h3><p>最后以 <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CRLF" target="_blank" rel="noopener">CRLF</a>+<code>--</code> +<code>边界分隔符</code>+<code>--</code> 标记结束：</p>
<pre><code class="bash"># 将结束标记添加到 postfile.txt
$ echo -e &quot;\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW--&quot; &gt;&gt; postfile.txt</code></pre>
<blockquote>
<p>因为在将文件流内容追加至 <code>postfile.txt</code> 文件后，已无法使用文本编辑器直接打开此文件，故继续使用命令追加文件内容，同样在 Windows 环境中可以通过 <code>git bash</code> 使用 <code>echo</code> 命令。</p>
</blockquote>
<h2 id="执行-ab-命令"><a href="#执行-ab-命令" class="headerlink" title="执行 ab 命令"></a>执行 ab 命令</h2><p>使用以下命令执行文件上传测试：</p>
<pre><code class="bash">$ ab -n 1 -c 1 -p postfile.txt -v 2 \
-T &quot;multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW&quot; \
http://localhost:8080/upload \
-v 2</code></pre>
<ul>
<li><code>-n 1</code> 表示总共发送 1 个请求（根据实际测试需求进行调整）。</li>
<li><code>-c 1</code> 表示同时并发 1 个请求（根据实际测试需求进行调整）。</li>
<li><code>-p postfile.txt</code> 指定包含<code>POST</code>数据的文件。</li>
<li><code>-T &quot;multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW&quot;</code> 指定请求的内容类型，包括之前定义的边界分隔符。</li>
<li><code>-v verbosity</code>用于设置 <code>ApacheBench</code> 的详细输出级别。在详细输出级别 <code>2</code> 下，<code>ApacheBench</code>会打印出警告信息和信息信息，如：请求和响应的头部信息。</li>
</ul>
<p>执行命令后，在控制台中，可以在 <code>LOG: header received:</code> 消息之后找到响应状态码和响应内容。如果状态码为 <code>200</code>且和预期值一致，表示服务器成功处理了请求。</p>
<p>在控制台中还会提供一系列关键指标，如每秒请求数、请求平均响应时间等关键指标。这些数据可以帮助分析文件上传的性能表现，并为优化提供依据。</p>
<pre><code class="text">This is ApacheBench, Version 2.3 &lt;$Revision: 1901567 $&gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking localhost (be patient)...INFO: POST header ==
---
POST /upload HTTP/1.0
Content-length: 24223
Content-type: multipart/form-data; boundary=---WebKitFormBoundary7MA4YWxkTrZu0gW
secret-id: 3e6bec50-3bbd-4443-b141-82aaee645cc7
secret-key: f1596671ce4d30a7847a91b8c674f43c
Host: localhost:8080
User-Agent: ApacheBench/2.3
Accept: */*


---
LOG: header received:
HTTP/1.1 200
Content-Type: text/plain;charset=UTF-8
Content-Length: 113
Date: Wed, 31 Jul 2024 13:37:18 GMT
Connection: close

File uploaded successfully: postfile.txt with size: 24072 bytes
..done


Server Software:
Server Hostname:        localhost
Server Port:            8080

Document Path:          /upload
Document Length:        113 bytes

Concurrency Level:      1
Time taken for tests:   0.056 seconds
Complete requests:      1
Failed requests:        0
Total transferred:      247 bytes
Total body sent:        24512
HTML transferred:       113 bytes
Requests per second:    17.73 [#/sec] (mean)
Time per request:       56.388 [ms] (mean)
Time per request:       56.388 [ms] (mean, across all concurrent requests)
Transfer rate:          4.28 [Kbytes/sec] received
                        424.51 kb/s sent
                        428.79 kb/s total

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.0      0       0
Processing:    56   56   0.0     56      56
Waiting:       53   53   0.0     53      53
Total:         56   56   0.0     56      56</code></pre>
<h2 id="扩展-putfile"><a href="#扩展-putfile" class="headerlink" title="扩展 putfile"></a>扩展 putfile</h2><p><code>ApacheBench (ab)</code> 同样适用于测试 <code>PUT</code>接口。构造<code>putfile</code>的方法与<code>POST</code>接口类似，只需确保请求体的内容和头部信息符合<code>PUT</code>请求的要求。</p>
<blockquote>
<p>-u putfile File containing data to PUT. Remember also to set -T</p>
</blockquote>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="单个文件"><a href="#单个文件" class="headerlink" title="单个文件"></a>单个文件</h3><p>构造命令：</p>
<pre><code class="Bash">echo -e &#39;------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name=&quot;file&quot;; filename=&quot;file1.jpg&quot;\r\n\r&#39; &gt; postfile.txt
cat 1.jpg &gt;&gt; postfile.txt
echo -e &quot;\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW--&quot; &gt;&gt; postfile.txt</code></pre>
<p>发送请求：</p>
<pre><code class="Bash">ab -n 1 -c 1 -p postfile.txt -v 2 \
-T &quot;multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW&quot; \
http://localhost:8080/upload</code></pre>
<h3 id="多个文件"><a href="#多个文件" class="headerlink" title="多个文件"></a>多个文件</h3><p>构造命令：</p>
<pre><code class="Bash">echo -e &#39;------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name=&quot;file1&quot;; filename=&quot;file1.jpg&quot;\r\n\r&#39; &gt; postfile.txt
cat 1.jpg &gt;&gt; postfile.txt
echo -e &quot;\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW\r&quot; &gt;&gt; postfile.txt
echo -e &#39;Content-Disposition: form-data; name=&quot;file2&quot;; filename=&quot;file2.zip&quot;\r\n\r&#39; &gt;&gt; postfile.txt
cat demo.zip &gt;&gt; postfile.txt
echo -e &quot;\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW--&quot; &gt;&gt; postfile.txt</code></pre>
<p>发送请求：</p>
<pre><code class="Bash">ab -n 1 -c 1 -p postfile.txt -v 2 \
-T &quot;multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW&quot; \
http://localhost:8080/upload2</code></pre>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
            <ul id="audio-list" style="display:none">
                
                
                <li title='0' data-url='/statics/background.mp3'></li>
                
                    
            </ul>
            
            
            
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='54f9966b8cc9d2423ffd'
        data-cs='504574e4532bdfa77d3e4091637ff53558408ac2'
        data-r='AlphaHinex.github.io'
        data-o='AlphaHinex'
        data-a='AlphaHinex'
        data-d=''
    >留言</div>


            
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="/img/hinex.jpg" height=300 width=300></img>
                    <p>Alpha Hinex</p>
                    <span>Stay Hungry. Stay Foolish.</span>
                    <dl>
                        <dd><a href="https://github.com/AlphaHinex" target="_blank"><span
                                    class=" iconfont icon-github"></span></a></dd>
                        <dd><a href="/whoami"><span class=" iconfont icon-wechat"></span></a></dd>
                        <dd><a href="" target="_blank"><span
                                    class=" iconfont icon-stack-overflow"></span></a></dd>
                    </dl>
                </div>
                <ul>
                    <li><a href="/">331 <p>文章</p></a></li>
                    <li><a href="/categories">78 <p>分类</p></a></li>
                    <li><a href="/tags">159 <p>标签</p></a></li>
                </ul>
            </div>
            
            
            
            <div class="box sticky animated fadeInRight faster">
                <div id="toc" class="subbox">
                    <h4>目录</h4>
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#摘要"><span class="toc-number">1.</span> <span class="toc-text">摘要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ApacheBench-简介"><span class="toc-number">2.</span> <span class="toc-text">ApacheBench 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前置条件"><span class="toc-number">3.</span> <span class="toc-text">前置条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题"><span class="toc-number">4.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#有关-multipart-form-data-的规范"><span class="toc-number">5.</span> <span class="toc-text">有关 multipart&#x2F;form-data 的规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构造-postfile"><span class="toc-number">6.</span> <span class="toc-text">构造 postfile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-准备-postfile-文件"><span class="toc-number">6.1.</span> <span class="toc-text">1. 准备 postfile 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-确定边界分隔符"><span class="toc-number">6.2.</span> <span class="toc-text">2. 确定边界分隔符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-编写-postfile-头区域及空白行"><span class="toc-number">6.3.</span> <span class="toc-text">3. 编写 postfile 头区域及空白行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-添加文件内容至-postfile-内容区域"><span class="toc-number">6.4.</span> <span class="toc-text">4. 添加文件内容至 postfile 内容区域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-添加结束标记"><span class="toc-number">6.5.</span> <span class="toc-text">5. 添加结束标记</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#执行-ab-命令"><span class="toc-number">7.</span> <span class="toc-text">执行 ab 命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#扩展-putfile"><span class="toc-number">8.</span> <span class="toc-text">扩展 putfile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附录"><span class="toc-number">9.</span> <span class="toc-text">附录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单个文件"><span class="toc-number">9.1.</span> <span class="toc-text">单个文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多个文件"><span class="toc-number">9.2.</span> <span class="toc-text">多个文件</span></a></li></ol></li></ol>
                </div>
            </div>
            
            
        </div>
    </div>
</div>

    </div>
</div>
    <div id="back-to-top" class="animated fadeIn faster">
        <div class="flow"></div>
        <span class="percentage animated fadeIn faster">0%</span>
        <span class="iconfont icon-top02 animated fadeIn faster"></span>
    </div>
</body>
<footer>
    <p>本站访客数<span id="busuanzi_value_site_uv"></span>人次 / 本站总访问量<span id="busuanzi_value_site_pv"></span>次</p>
    <p class="copyright" id="copyright">
        &copy; 2026
        <span class="gradient-text">
            Alpha Hinex
        </span>.
        Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
        Theme
        <span class="gradient-text">
            <a href="https://github.com/TriDiamond/hexo-theme-obsidian" title="Obsidian" target="_blank" rel="noopener">Obsidian</a>
        </span>
        <small><a href="https://github.com/TriDiamond/hexo-theme-obsidian/blob/master/CHANGELOG.md" title="v1.4.3" target="_blank" rel="noopener">v1.4.3</a></small>
    </p>
</footer>

<script type="text/javascript" src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  MathJax.Hub.Config({
    "HTML-CSS": {
      preferredFont: "TeX",
      availableFonts: ["STIX", "TeX"],
      linebreaks: {
        automatic: true
      },
      EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
      inlineMath: [
        ["$", "$"],
        ["\\(", "\\)"]
      ],
      processEscapes: true,
      ignoreClass: "tex2jax_ignore|dno",
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      noUndefined: {
        attributes: {
          mathcolor: "red",
          mathbackground: "#FFEEEE",
          mathsize: "90%"
        }
      },
      Macros: {
        href: "{}"
      }
    },
    messageStyle: "none"
  });
</script>
<script>
  function initialMathJax() {
    MathJax.Hub.Queue(function () {
      var all = MathJax.Hub.getAllJax(),
        i;
      // console.log(all);
      for (i = 0; i < all.length; i += 1) {
        console.log(all[i].SourceElement().parentNode)
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  }

  function reprocessMathJax() {
    if (typeof MathJax !== 'undefined') {
      MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    }
  }
</script>



    
<link rel="stylesheet" href="/css/gitalk.css">

    
<script src="/js/gitalk.min.js"></script>



<script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/obsidian.js"></script>
<script src="/js/jquery.truncate.js"></script>
<script src="/js/search.js"></script>


<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/typed.js/2.0.10/typed.min.js"></script>


<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/blueimp-md5/2.12.0/js/md5.min.js"></script>


<script src="/js/social-share.min.js"></script>


<script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/codemirror.min.js"></script>

    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/javascript/javascript.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/css/css.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/xml/xml.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/htmlmixed/htmlmixed.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/clike/clike.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/php/php.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/shell/shell.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/python/python.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/groovy/groovy.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/diff/diff.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/nginx/nginx.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/properties/properties.min.js"></script>




    
<script src="/js/busuanzi.min.js"></script>

    <script>
        $(document).ready(function () {
            if ($('span[id^="busuanzi_"]').length) {
                initialBusuanzi();
            }
        });
    </script>



<link rel="stylesheet" href="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css">


<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>



    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="//www.googletagmanager.com/gtag/js?id=UA-69084811-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-69084811-1');
    </script>





<script>
    function initialTyped () {
        var typedTextEl = $('.typed-text');
        if (typedTextEl && typedTextEl.length > 0) {
            var typed = new Typed('.typed-text', {
                strings: ["Stay Hungry. Stay Foolish.", "常与同好争高下，莫与傻子论短长"],
                typeSpeed: 90,
                loop: true,
                loopCount: Infinity,
                backSpeed: 20,
            });
        }
    }

    if ($('.article-header') && $('.article-header').length) {
        $(document).ready(function () {
            initialTyped();
        });
    }
</script>




</html>
