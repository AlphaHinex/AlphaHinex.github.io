
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>《GraphQL in Action》书摘 - Alpha Hinex&#39;s Blog</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Java, JavaScript, Spring, Html5, NoSQL, Docker, DevOps,GraphQL, GraphiQL, GraphQL.js, query, mutation, subscription"> 
    <meta name="description" content="Chapter 1: Introduction to GraphQL1.1 What is GraphQL?1.1.2 GraphQL is a specification
GraphQL oper,"> 
    <meta name="author" content="Alpha Hinex"> 

    <meta name="msvalidate.01" content="D769824B4D44C14A4C777A6EC4E898FC"> 
    <meta name="baidu-site-verification" content="TimiEK4Y9V"> 
    <meta name="google-site-verification" content="B-WME81HWSnMIkZZxcxv7bVI6yjbpAFKvifi2X-EkzQ"> 

    <link rel="alternative" href="atom.xml" title="Alpha Hinex&#39;s Blog" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link href="https://fonts.loli.net/css?family=Roboto+Mono|Rubik&display=swap" rel="stylesheet">
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">

    
<link rel="stylesheet" href="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/animate.css/3.7.2/animate.min.css">

    
<link rel="stylesheet" href="/css/share.min.css">

    
<link rel="stylesheet" href="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/codemirror.min.css">

    
<link rel="stylesheet" href="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/theme/dracula.css">

    
<link rel="stylesheet" href="/css/obsidian.css">

    
<link rel="stylesheet" href="/css/ball-atom.min.css">

<meta name="generator" content="Hexo 4.2.1"></head>


<body class="loading">
    <div class="loader">
        <div class="la-ball-atom la-2x">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <span id="config-title" style="display:none">Alpha Hinex&#39;s Blog</span>
    <div id="loader"></div>
    <div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" class="icon-home" src="/img/favicon.png" alt="" data-url="https://AlphaHinex.github.io">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">《GraphQL in Action》书摘</h3>
        <div class="social">
            <!--        <div class="like-icon">-->
            <!--            <a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
            <!--        </div>-->
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
            animation-delay: 600ms;
            animation-duration: 1.2s;
            background-image: 
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(/contents/graphql-in-action/cover.jpg);">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                <a href="/categories/Book"><b>「
                    </b>BOOK<b> 」</b></a>
                
                四月 22, 2023
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/2023/04/22/graphql-in-action/" title="《GraphQL in Action》书摘" class="">《GraphQL in Action》书摘</a>
            </h3>
            
            <p class="post-count animated fadeInDown">
                
                <span>
                    <b class="iconfont icon-text2"></b> <i>文章字数</i>
                    23k
                </span>
                
                
                <span>
                    <b class="iconfont icon-timer__s"></b> <i>阅读约需</i>
                    21 mins.
                </span>
                
                
                
                <span id="busuanzi_page_pv_container" style="display: flex;">
                    <b class="iconfont icon-read"></b> <i>阅读次数</i>
                    <span id="busuanzi_value_page_pv"></span>
                </span>
                
            </p>
            
            
            <ul class="animated fadeInDown post-tags-list" itemprop="keywords"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/GraphQL/" rel="tag">GraphQL</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <h1 id="Chapter-1-Introduction-to-GraphQL"><a href="#Chapter-1-Introduction-to-GraphQL" class="headerlink" title="Chapter 1: Introduction to GraphQL"></a>Chapter 1: Introduction to GraphQL</h1><h2 id="1-1-What-is-GraphQL"><a href="#1-1-What-is-GraphQL" class="headerlink" title="1.1 What is GraphQL?"></a>1.1 What is GraphQL?</h2><h3 id="1-1-2-GraphQL-is-a-specification"><a href="#1-1-2-GraphQL-is-a-specification" class="headerlink" title="1.1.2 GraphQL is a specification"></a>1.1.2 GraphQL is a specification</h3><blockquote>
<h4 id="GraphQL-operations"><a href="#GraphQL-operations" class="headerlink" title="GraphQL operations"></a>GraphQL operations</h4><p>Queries represent <code>READ</code> operations. Mutations represent <code>WRITE</code>-then-<code>READ</code> opera- tions. You can think of mutations as queries that have side effects.</p>
<p>In addition to queries and mutations, GraphQL also supports a third request type called a subscription, used for real-time data monitoring requests. Subscriptions represent continuous <code>READ</code> operations. Mutations usually trigger events for subscriptions.</p>
<p>GraphQL subscriptions require the use of a data-transport channel that supports con- tinuous pushing of data. That’s usually done with WebSockets for web applications.</p>
</blockquote>
<h2 id="1-2-Why-GraphQL"><a href="#1-2-Why-GraphQL" class="headerlink" title="1.2 Why GraphQL?"></a>1.2 Why GraphQL?</h2><blockquote>
<h4 id="GraphQL-is-a-translator"><a href="#GraphQL-is-a-translator" class="headerlink" title="GraphQL is a translator"></a>GraphQL is a translator</h4><p>Imagine three people who speak three different languages and have different types of knowledge. Then imagine that you have a question that can only be answered by combining the knowledge of all three people. If you have a translator who speaks all three languages, the task of putting together an answer to your question becomes easy. That is what a GraphQL service can do for clients. This point is valid with other data API options, but GraphQL provides standard structures that enable implementing this kind of data need in easier and more maintainable ways.</p>
</blockquote>
<h3 id="1-2-1-What-about-REST-APIs"><a href="#1-2-1-What-about-REST-APIs" class="headerlink" title="1.2.1 What about REST APIs?"></a>1.2.1 What about REST APIs?</h3><ul>
<li>It is important to point out here that REST APIs have some advantages over GraphQL APIs. For example, caching a REST API response is easier than caching a GraphQL API response, as you will see in the last section of this chapter. Also, optimizing the code for different REST endpoints is easier than optimizing the code for a single generic endpoint. There is no single magical solution that fixes all issues without introducing new challenges. REST APIs have their place, and when used correctly, both GraphQL and REST have great applications. Also, nothing prohibits using them together in the same system.</li>
</ul>
<h2 id="1-3-GraphQL-problems"><a href="#1-3-GraphQL-problems" class="headerlink" title="1.3 GraphQL problems"></a>1.3 GraphQL problems</h2><h3 id="1-3-1-Security"><a href="#1-3-1-Security" class="headerlink" title="1.3.1 Security"></a>1.3.1 Security</h3><ul>
<li>A critical threat for GraphQL APIs is resource-exhaustion attacks (aka denial-of-service attacks). </li>
<li>Authentication and authorization are other concerns that you need to think about when working with GraphQL.</li>
</ul>
<h3 id="1-3-2-Caching-and-optimizing"><a href="#1-3-2-Caching-and-optimizing" class="headerlink" title="1.3.2 Caching and optimizing"></a>1.3.2 Caching and optimizing</h3><ul>
<li>One task that GraphQL makes a bit more challenging is clients’ caching of data.</li>
<li>One of the other most famous problems you may encounter when working with GraphQL is commonly referred to as N+1 SQL queries.</li>
</ul>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><ul>
<li>A GraphQL system has two primary components: the query language, which can be used by consumers of data APIs to request their exact data needs; and the runtime layer on the backend, which publishes a public schema describing the capabilities and requirements of data models. The runtime layer accepts incoming requests on a single endpoint and resolves incoming data requests with predictable data responses. Incoming requests are strings written with the GraphQL query language.</li>
<li>A GraphQL service can be written in any programming language, and it can be conceptually split into two major parts: a structure that is defined with a strongly typed schema representing the capabilities of the API, and behavior that is naturally implemented with functions known as resolvers. A GraphQL schema is a graph of fields, which have types. This graph represents all the possible data objects that can be read (or updated) through the GraphQL service. Each field in a GraphQL schema is backed by a resolver function.</li>
<li>The difference between GraphQL and its previous alternatives is that it provides standards and structures to implement API features in maintainable and scalable ways. The alternatives lack such standards. GraphQL also solves many technical challenges like having to do multiple network round trips and deal with multiple data responses on the client.</li>
<li>GraphQL has some challenges, especially in the areas of security and optimiza- tion. Because of the flexibility it provides, securing a GraphQL API requires thinking about more vulnerabilities. Caching a flexible GraphQL API is also a lot harder than caching fixed API endpoints (as in REST APIs). The GraphQL learning curve is also steeper than that of many of its alternatives.</li>
</ul>
<h1 id="Chapter-2-Exploring-GraphQL-APIs"><a href="#Chapter-2-Exploring-GraphQL-APIs" class="headerlink" title="Chapter 2: Exploring GraphQL APIs"></a>Chapter 2: Exploring GraphQL APIs</h1><h2 id="2-1-The-GraphiQL-editor"><a href="#2-1-The-GraphiQL-editor" class="headerlink" title="2.1 The GraphiQL editor"></a>2.1 The GraphiQL editor</h2><ul>
<li>GraphiQL (with an i before the QL and pronounced “graphical”). GraphiQL is an open source web application (written with React.js and GraphQL) that can be run in a browser.</li>
</ul>
<h2 id="2-2-The-basics-of-the-GraphQL-language"><a href="#2-2-The-basics-of-the-GraphQL-language" class="headerlink" title="2.2 The basics of the GraphQL language"></a>2.2 The basics of the GraphQL language</h2><h3 id="2-2-1-Requests"><a href="#2-2-1-Requests" class="headerlink" title="2.2.1 Requests"></a>2.2.1 Requests</h3><ul>
<li>The structure of a GraphQL request<br>  <img src="/contents/graphql-in-action/figure2.7.png" alt="figure2.7"></li>
<li>Three types of operations can be used in GraphQL:</li>
</ul>
<ol>
<li>Query operations that represent a read-only fetch</li>
<li>Mutation operations that represent a write followed by a fetch</li>
<li>Subscription operations that represent a request for real-time data updates</li>
</ol>
<h3 id="2-2-2-Fields"><a href="#2-2-2-Fields" class="headerlink" title="2.2.2 Fields"></a>2.2.2 Fields</h3><ul>
<li>GraphQL schemas often support four major scalar types: <code>Int</code>, <code>String</code>, <code>Float</code>, and <code>Boolean</code>. The built-in custom scalar value <code>ID</code> can also be used to represent identity values.</li>
</ul>
<h2 id="2-3-Examples-from-the-GitHub-API"><a href="#2-3-Examples-from-the-GitHub-API" class="headerlink" title="2.3 Examples from the GitHub API"></a>2.3 Examples from the GitHub API</h2><h3 id="2-3-3-Introspective-queries"><a href="#2-3-3-Introspective-queries" class="headerlink" title="2.3.3 Introspective queries"></a>2.3.3 Introspective queries</h3><ul>
<li>Fields with names that begin with double underscore characters are reserved for introspection support.</li>
</ul>
<h1 id="Chapter-3-Customizing-and-organizing-GraphQL-operations"><a href="#Chapter-3-Customizing-and-organizing-GraphQL-operations" class="headerlink" title="Chapter 3: Customizing and organizing GraphQL operations"></a>Chapter 3: Customizing and organizing GraphQL operations</h1><h2 id="3-2-Renaming-fields-with-aliases"><a href="#3-2-Renaming-fields-with-aliases" class="headerlink" title="3.2 Renaming fields with aliases"></a>3.2 Renaming fields with aliases</h2><ul>
<li>Luckily, in GraphQL, the awesome alias feature lets us declaratively instruct the API server to return fields using different names. All you need to do is specify an alias for that field, which you can do using this syntax:<pre><code class="graphql">  aliasName: fieldName</code></pre>
</li>
<li>Listing 3.14 Profile information query with an alias (az.dev/gia)<pre><code class="graphql">  query ProfileInfoWithAlias {
      user(login: &quot;samerbuna&quot;) {
          name
          companyName: company
          bio
      }
  }</code></pre>
</li>
</ul>
<h2 id="3-3-Customizing-responses-with-directives"><a href="#3-3-Customizing-responses-with-directives" class="headerlink" title="3.3 Customizing responses with directives"></a>3.3 Customizing responses with directives</h2><ul>
<li>A directive is any string in a GraphQL document that begins with the <code>@</code> character. Every GraphQL schema has three built-in directives: <code>@include</code>, <code>@skip</code>, and <code>@deprecated</code>. Some schemas have more directives. You can use this introspective query to see the list of directives supported by a schema.</li>
<li>Listing 3.15 All the supported directives in a schema (az.dev/gia)<pre><code class="graphql">  query AllDirectives {
      __schema {
          directives {
              name
              description
              locations
              args {
                  name
                  description
                  defaultValue
              }
          }
      }
  }</code></pre>
</li>
</ul>
<h3 id="3-3-1-Variables-and-input-values"><a href="#3-3-1-Variables-and-input-values" class="headerlink" title="3.3.1 Variables and input values"></a>3.3.1 Variables and input values</h3><ul>
<li>A <code>variable</code> is simply any name in the GraphQL document that begins with a <code>$</code> sign: for example, <code>$login</code> or <code>$showRepositories</code>.</li>
</ul>
<h2 id="3-4-GraphQL-fragments"><a href="#3-4-GraphQL-fragments" class="headerlink" title="3.4 GraphQL fragments"></a>3.4 GraphQL fragments</h2><h3 id="3-4-2-Defining-and-using-fragments"><a href="#3-4-2-Defining-and-using-fragments" class="headerlink" title="3.4.2 Defining and using fragments"></a>3.4.2 Defining and using fragments</h3><ul>
<li>To define a GraphQL fragment, you can use the <code>fragment</code> top-level keyword in any GraphQL document. You give the fragment a name and specify the type on which that fragment can be used. Then, you write a partial query to represent the fragment.</li>
<li>Listing 3.22 Defining a fragment in GraphQL<pre><code class="graphql">  fragment orgFields on Organization {
      name
      description
      websiteUrl
  }</code></pre>
</li>
<li>Listing 3.23 Using a fragment in GraphQL<pre><code class="graphql">  query OrgInfoWithFragment {
      organization(login: &quot;jscomplete&quot;) {
          ...orgFields
      }
  }</code></pre>
</li>
<li>The three dots before <code>orgFields</code> are what you use to spread that fragment. The concept of spreading a fragment is similar to the concept of spreading an object in JavaScript. The same three-dots operator can be used in JavaScript to spread an object inside another object, effectively cloning that object.</li>
<li>The three-dotted fragment name (<code>...orgFields</code>) is called a <code>fragment spread</code>. You can use a fragment spread anywhere you use a regular field in any GraphQL operation.</li>
<li>There are no generic fragments in GraphQL. Also, when a fragment is defined in a GraphQL document, that fragment must be used somewhere. You cannot send a GraphQL<br>server a document that defines fragments but does not use them.</li>
</ul>
<h3 id="3-4-5-Inline-fragments-for-interfaces-and-unions"><a href="#3-4-5-Inline-fragments-for-interfaces-and-unions" class="headerlink" title="3.4.5 Inline fragments for interfaces and unions"></a>3.4.5 Inline fragments for interfaces and unions</h3><ul>
<li>Listing 3.36 Using inline fragments with union types (az.dev/gia)<pre><code class="graphql">query RepoUnionExampleFull {
  repository(owner: &quot;facebook&quot;, name: &quot;graphql&quot;) {
      issueOrPullRequest(number: 5) { 
          ... on PullRequest {
              merged
              mergedAt
          }
          ... on Issue {
              closed
              closedAt
          }
      }
  }
}</code></pre>
</li>
</ul>
<h1 id="Chapter-4-Designing-a-GraphQL-schema"><a href="#Chapter-4-Designing-a-GraphQL-schema" class="headerlink" title="Chapter 4: Designing a GraphQL schema"></a>Chapter 4: Designing a GraphQL schema</h1><h2 id="4-2-The-API-requirements-for-AZdev"><a href="#4-2-The-API-requirements-for-AZdev" class="headerlink" title="4.2 The API requirements for AZdev"></a>4.2 The API requirements for AZdev</h2><h3 id="4-2-1-The-core-types"><a href="#4-2-1-The-core-types" class="headerlink" title="4.2.1 The core types"></a>4.2.1 The core types</h3><ul>
<li>GraphQL does not have a built-in format for date-time fields. The easiest way to work with these fields is to serialize them as strings in a standard format (like ISO/UTC).</li>
<li>Remember that the exclamation mark after the ID and String types indicates that these fields cannot have null values.</li>
<li>Another type modifier is a pair of square brackets around the type (for example, [String]) to indicate that a type is a list of items of another type.</li>
</ul>
<h2 id="4-3-Queries"><a href="#4-3-Queries" class="headerlink" title="4.3 Queries"></a>4.3 Queries</h2><h3 id="4-3-1-Listing-the-latest-Task-records"><a href="#4-3-1-Listing-the-latest-Task-records" class="headerlink" title="4.3.1 Listing the latest Task records"></a>4.3.1 Listing the latest Task records</h3><ul>
<li>A general good practice in GraphQL schemas is to make the types of fields non-null, unless you have a reason to distinguish between null and empty.</li>
<li>However, root fields are special because making them nullable has an important consequence.</li>
<li>One bad root field should not block the data response of other root fields.</li>
<li>The semantic meaning of this nullability is, in this case, “Something went wrong in the resolver of this root field, and we’re allowing it so that a response can still have partial data for other root fields.”</li>
</ul>
<h3 id="4-3-2-Search-and-the-union-interface-types"><a href="#4-3-2-Search-and-the-union-interface-types" class="headerlink" title="4.3.2 Search and the union/interface types"></a>4.3.2 Search and the union/interface types</h3><ul>
<li>A GraphQL type can also implement multiple interface types. In SDL, you can just use a comma-separated list of interface types to implement.</li>
</ul>
<h3 id="4-3-6-The-ENUM-type"><a href="#4-3-6-The-ENUM-type" class="headerlink" title="4.3.6 The ENUM type"></a>4.3.6 The ENUM type</h3><ul>
<li>Listing 4.16 The ApproachDetailCategory ENUM type<pre><code class="graphql">  enum ApproachDetailCategory {
      NOTE
      EXPLANATION
      WARNING
  }</code></pre>
</li>
</ul>
<h2 id="4-4-Mutations"><a href="#4-4-Mutations" class="headerlink" title="4.4 Mutations"></a>4.4 Mutations</h2><h3 id="4-4-1-Mutation-input"><a href="#4-4-1-Mutation-input" class="headerlink" title="4.4.1 Mutation input"></a>4.4.1 Mutation input</h3><ul>
<li>Instead of defining four scalar arguments for the <code>userCreate</code> mutation, we can group these input values as one input object argument. We use the <code>input</code> keyword to do that.</li>
<li>Listing 4.24 Incremental UI-driven schema design<pre><code class="graphql">  input UserInput {
      username: String!
      password: String!
      firstName: String
      lastName: String
  }</code></pre>
</li>
</ul>
<h3 id="4-4-4-Creating-and-voting-on-Approach-entries"><a href="#4-4-4-Creating-and-voting-on-Approach-entries" class="headerlink" title="4.4.4 Creating and voting on Approach entries"></a>4.4.4 Creating and voting on Approach entries</h3><ul>
<li>We just put the comment text on the line before the field that needs it and surround that text with triple quotes (“””).</li>
<li>Listing 4.32 Adding description text<pre><code class="graphql">  input ApproachVoteInput {
      &quot;&quot;&quot;true for up-vote and false for down-vote&quot;&quot;&quot;
      up: Boolean!
  }</code></pre>
</li>
<li>The clarifying text is known as a <code>description</code> in a GraphQL schema, and it is part of the structure of that schema. It’s not really a comment but rather a property of this type. Tools like GraphiQL expect it and display it in autocomplete lists and documentation explorers. You should consider adding a description property to any field that could use an explanation.</li>
</ul>
<h2 id="4-7-Designing-database-models"><a href="#4-7-Designing-database-models" class="headerlink" title="4.7 Designing database models"></a>4.7 Designing database models</h2><h3 id="4-7-2-The-Task-Approach-models"><a href="#4-7-2-The-Task-Approach-models" class="headerlink" title="4.7.2 The Task/Approach models"></a>4.7.2 The Task/Approach models</h3><ul>
<li>PostgreSQL has an advanced feature to manage a list of items for a single row. A PostgreSQL column can have an array data type!</li>
</ul>
<h1 id="Chapter-5-Implementing-schema-resolvers"><a href="#Chapter-5-Implementing-schema-resolvers" class="headerlink" title="Chapter 5: Implementing schema resolvers"></a>Chapter 5: Implementing schema resolvers</h1><h2 id="5-2-Setting-up-the-GraphQL-runtime"><a href="#5-2-Setting-up-the-GraphQL-runtime" class="headerlink" title="5.2 Setting up the GraphQL runtime"></a>5.2 Setting up the GraphQL runtime</h2><h3 id="5-2-2-Creating-resolver-functions"><a href="#5-2-2-Creating-resolver-functions" class="headerlink" title="5.2.2 Creating resolver functions"></a>5.2.2 Creating resolver functions</h3><ul>
<li>Each field defined in the schema needs to be associated with a resolver function. When it is time for the server to reply with data for that field, it will just execute that field’s resolver function and use the function’s return value as the data response for the field.</li>
</ul>
<h2 id="5-3-Communicating-over-HTTP"><a href="#5-3-Communicating-over-HTTP" class="headerlink" title="5.3 Communicating over HTTP"></a>5.3 Communicating over HTTP</h2><ul>
<li><code>nodemon</code> runs a node process while monitoring files for changes and automatically restarts that node process when it detects changes to the files. That makes the API server auto-restart whenever you save any file in the api directory.</li>
</ul>
<h2 id="5-4-Building-a-schema-using-constructor-objects"><a href="#5-4-Building-a-schema-using-constructor-objects" class="headerlink" title="5.4 Building a schema using constructor objects"></a>5.4 Building a schema using constructor objects</h2><h3 id="5-4-3-Custom-object-types"><a href="#5-4-3-Custom-object-types" class="headerlink" title="5.4.3 Custom object types"></a>5.4.3 Custom object types</h3><ul>
<li>GraphiQL supports rendering Markdown in descriptions out of the box!</li>
</ul>
<h1 id="Chapter-7-Optimizing-data-fetching"><a href="#Chapter-7-Optimizing-data-fetching" class="headerlink" title="Chapter 7: Optimizing data fetching"></a>Chapter 7: Optimizing data fetching</h1><h2 id="7-1-Caching-and-batching"><a href="#7-1-Caching-and-batching" class="headerlink" title="7.1 Caching and batching"></a>7.1 Caching and batching</h2><ul>
<li>DataLoader is a generic JavaScript utility library that can be injected into your application’s data-fetching layer to manage caching and batching operations on your behalf.</li>
<li>Note that <code>DataLoader</code> uses simple single-resource batching and short-term caching. There are other GraphQL-to-database execution layers that use multiresource batching (without caching and its many problems) to achieve similar (and often better) performance improvements. However, I think the <code>DataLoader</code> approach is simpler, more flexible, and easier to maintain.</li>
</ul>
<h2 id="7-3-Circular-dependencies-in-GraphQL-types"><a href="#7-3-Circular-dependencies-in-GraphQL-types" class="headerlink" title="7.3 Circular dependencies in GraphQL types"></a>7.3 Circular dependencies in GraphQL types</h2><ul>
<li>Instead of using types directly under the <code>fields</code> property, that property can be a function whose return value is the object representing the fields. GraphQL.js supports this out of the box, and it’s handy for situations like these.</li>
<li>Listing 7.25 Changes in api/src/schema/types/approach.js<pre><code class="js">  const Approach = new GraphQLObjectType({
      name: &#39;Approach&#39;,
      fields: () =&gt; ({ 
          // ·-·-·
          task: {
              type: new GraphQLNonNull(Task),
              resolve: (source, args, { pgApi }) =&gt;
                  pgApi.tasks.load(source.taskId), 
          },
      }), 
  });</code></pre>
</li>
<li>It is a good practice to <code>always</code> use the function signature for the <code>fields</code> configuration property instead of the object form.</li>
</ul>
<h2 id="Summary-1"><a href="#Summary-1" class="headerlink" title="Summary"></a>Summary</h2><ul>
<li>To optimize data-fetching operations in a generic, scalable way, you can use the concepts of caching and batching. You can cache SQL responses based on unique values like IDs or any other custom unique values you design in your API service. You can also delay asking the database about a specific resource until you figure out all the unique IDs of all the records needed from that resource and then send a single request to the database to include all the records based on all the IDs.</li>
<li><code>DataLoader</code> is a generic JavaScript library that can be used as part of your application’s data-fetching layer to provide a simplified, consistent API over various data sources and abstract the use of batching and caching.</li>
</ul>
<h1 id="Chapter-8-Implementing-mutations"><a href="#Chapter-8-Implementing-mutations" class="headerlink" title="Chapter 8: Implementing mutations"></a>Chapter 8: Implementing mutations</h1><h2 id="Summary-2"><a href="#Summary-2" class="headerlink" title="Summary"></a>Summary</h2><ul>
<li>To host mutations, a GraphQL schema must define a root mutation type.</li>
</ul>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
            <ul id="audio-list" style="display:none">
                
                
                <li title='0' data-url='/statics/background.mp3'></li>
                
                    
            </ul>
            
            
            
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='54f9966b8cc9d2423ffd'
        data-cs='504574e4532bdfa77d3e4091637ff53558408ac2'
        data-r='AlphaHinex.github.io'
        data-o='AlphaHinex'
        data-a='AlphaHinex'
        data-d=''
    >留言</div>


            
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="/img/hinex.jpg" height=300 width=300></img>
                    <p>Alpha Hinex</p>
                    <span>Stay Hungry. Stay Foolish.</span>
                    <dl>
                        <dd><a href="https://github.com/AlphaHinex" target="_blank"><span
                                    class=" iconfont icon-github"></span></a></dd>
                        <dd><a href="/whoami"><span class=" iconfont icon-wechat"></span></a></dd>
                        <dd><a href="" target="_blank"><span
                                    class=" iconfont icon-stack-overflow"></span></a></dd>
                    </dl>
                </div>
                <ul>
                    <li><a href="/">314 <p>文章</p></a></li>
                    <li><a href="/categories">76 <p>分类</p></a></li>
                    <li><a href="/tags">153 <p>标签</p></a></li>
                </ul>
            </div>
            
            
            
            <div class="box sticky animated fadeInRight faster">
                <div id="toc" class="subbox">
                    <h4>目录</h4>
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-1-Introduction-to-GraphQL"><span class="toc-number">1.</span> <span class="toc-text">Chapter 1: Introduction to GraphQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-What-is-GraphQL"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 What is GraphQL?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-2-GraphQL-is-a-specification"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1.2 GraphQL is a specification</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Why-GraphQL"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 Why GraphQL?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-What-about-REST-APIs"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 What about REST APIs?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-GraphQL-problems"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 GraphQL problems</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-Security"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1 Security</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-Caching-and-optimizing"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.3.2 Caching and optimizing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary"><span class="toc-number">1.3.3.</span> <span class="toc-text">Summary</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-2-Exploring-GraphQL-APIs"><span class="toc-number">2.</span> <span class="toc-text">Chapter 2: Exploring GraphQL APIs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-The-GraphiQL-editor"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 The GraphiQL editor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-The-basics-of-the-GraphQL-language"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 The basics of the GraphQL language</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-Requests"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 Requests</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-Fields"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 Fields</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Examples-from-the-GitHub-API"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Examples from the GitHub API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-Introspective-queries"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.3 Introspective queries</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-3-Customizing-and-organizing-GraphQL-operations"><span class="toc-number">3.</span> <span class="toc-text">Chapter 3: Customizing and organizing GraphQL operations</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Renaming-fields-with-aliases"><span class="toc-number">3.1.</span> <span class="toc-text">3.2 Renaming fields with aliases</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Customizing-responses-with-directives"><span class="toc-number">3.2.</span> <span class="toc-text">3.3 Customizing responses with directives</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-Variables-and-input-values"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.3.1 Variables and input values</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-GraphQL-fragments"><span class="toc-number">3.3.</span> <span class="toc-text">3.4 GraphQL fragments</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-Defining-and-using-fragments"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.4.2 Defining and using fragments</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-5-Inline-fragments-for-interfaces-and-unions"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.4.5 Inline fragments for interfaces and unions</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-4-Designing-a-GraphQL-schema"><span class="toc-number">4.</span> <span class="toc-text">Chapter 4: Designing a GraphQL schema</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-The-API-requirements-for-AZdev"><span class="toc-number">4.1.</span> <span class="toc-text">4.2 The API requirements for AZdev</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-The-core-types"><span class="toc-number">4.1.1.</span> <span class="toc-text">4.2.1 The core types</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-Queries"><span class="toc-number">4.2.</span> <span class="toc-text">4.3 Queries</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-Listing-the-latest-Task-records"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.3.1 Listing the latest Task records</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-Search-and-the-union-interface-types"><span class="toc-number">4.2.2.</span> <span class="toc-text">4.3.2 Search and the union&#x2F;interface types</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-6-The-ENUM-type"><span class="toc-number">4.2.3.</span> <span class="toc-text">4.3.6 The ENUM type</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-Mutations"><span class="toc-number">4.3.</span> <span class="toc-text">4.4 Mutations</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-1-Mutation-input"><span class="toc-number">4.3.1.</span> <span class="toc-text">4.4.1 Mutation input</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-4-Creating-and-voting-on-Approach-entries"><span class="toc-number">4.3.2.</span> <span class="toc-text">4.4.4 Creating and voting on Approach entries</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7-Designing-database-models"><span class="toc-number">4.4.</span> <span class="toc-text">4.7 Designing database models</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-2-The-Task-Approach-models"><span class="toc-number">4.4.1.</span> <span class="toc-text">4.7.2 The Task&#x2F;Approach models</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-5-Implementing-schema-resolvers"><span class="toc-number">5.</span> <span class="toc-text">Chapter 5: Implementing schema resolvers</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-Setting-up-the-GraphQL-runtime"><span class="toc-number">5.1.</span> <span class="toc-text">5.2 Setting up the GraphQL runtime</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-Creating-resolver-functions"><span class="toc-number">5.1.1.</span> <span class="toc-text">5.2.2 Creating resolver functions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-Communicating-over-HTTP"><span class="toc-number">5.2.</span> <span class="toc-text">5.3 Communicating over HTTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-Building-a-schema-using-constructor-objects"><span class="toc-number">5.3.</span> <span class="toc-text">5.4 Building a schema using constructor objects</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-3-Custom-object-types"><span class="toc-number">5.3.1.</span> <span class="toc-text">5.4.3 Custom object types</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-7-Optimizing-data-fetching"><span class="toc-number">6.</span> <span class="toc-text">Chapter 7: Optimizing data fetching</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-Caching-and-batching"><span class="toc-number">6.1.</span> <span class="toc-text">7.1 Caching and batching</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-Circular-dependencies-in-GraphQL-types"><span class="toc-number">6.2.</span> <span class="toc-text">7.3 Circular dependencies in GraphQL types</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-1"><span class="toc-number">6.3.</span> <span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-8-Implementing-mutations"><span class="toc-number">7.</span> <span class="toc-text">Chapter 8: Implementing mutations</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-2"><span class="toc-number">7.1.</span> <span class="toc-text">Summary</span></a></li></ol></li></ol>
                </div>
            </div>
            
            
        </div>
    </div>
</div>

    </div>
</div>
    <div id="back-to-top" class="animated fadeIn faster">
        <div class="flow"></div>
        <span class="percentage animated fadeIn faster">0%</span>
        <span class="iconfont icon-top02 animated fadeIn faster"></span>
    </div>
</body>
<footer>
    <p>本站访客数<span id="busuanzi_value_site_uv"></span>人次 / 本站总访问量<span id="busuanzi_value_site_pv"></span>次</p>
    <p class="copyright" id="copyright">
        &copy; 2025
        <span class="gradient-text">
            Alpha Hinex
        </span>.
        Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
        Theme
        <span class="gradient-text">
            <a href="https://github.com/TriDiamond/hexo-theme-obsidian" title="Obsidian" target="_blank" rel="noopener">Obsidian</a>
        </span>
        <small><a href="https://github.com/TriDiamond/hexo-theme-obsidian/blob/master/CHANGELOG.md" title="v1.4.3" target="_blank" rel="noopener">v1.4.3</a></small>
    </p>
</footer>

<script type="text/javascript" src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  MathJax.Hub.Config({
    "HTML-CSS": {
      preferredFont: "TeX",
      availableFonts: ["STIX", "TeX"],
      linebreaks: {
        automatic: true
      },
      EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
      inlineMath: [
        ["$", "$"],
        ["\\(", "\\)"]
      ],
      processEscapes: true,
      ignoreClass: "tex2jax_ignore|dno",
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      noUndefined: {
        attributes: {
          mathcolor: "red",
          mathbackground: "#FFEEEE",
          mathsize: "90%"
        }
      },
      Macros: {
        href: "{}"
      }
    },
    messageStyle: "none"
  });
</script>
<script>
  function initialMathJax() {
    MathJax.Hub.Queue(function () {
      var all = MathJax.Hub.getAllJax(),
        i;
      // console.log(all);
      for (i = 0; i < all.length; i += 1) {
        console.log(all[i].SourceElement().parentNode)
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  }

  function reprocessMathJax() {
    if (typeof MathJax !== 'undefined') {
      MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    }
  }
</script>



    
<link rel="stylesheet" href="/css/gitalk.css">

    
<script src="/js/gitalk.min.js"></script>



<script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/obsidian.js"></script>
<script src="/js/jquery.truncate.js"></script>
<script src="/js/search.js"></script>


<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/typed.js/2.0.10/typed.min.js"></script>


<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/blueimp-md5/2.12.0/js/md5.min.js"></script>


<script src="/js/social-share.min.js"></script>


<script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/codemirror.min.js"></script>

    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/javascript/javascript.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/css/css.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/xml/xml.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/htmlmixed/htmlmixed.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/clike/clike.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/php/php.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/shell/shell.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/python/python.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/groovy/groovy.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/diff/diff.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/nginx/nginx.min.js"></script>


    
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/codemirror/5.48.4/mode/properties/properties.min.js"></script>




    
<script src="/js/busuanzi.min.js"></script>

    <script>
        $(document).ready(function () {
            if ($('span[id^="busuanzi_"]').length) {
                initialBusuanzi();
            }
        });
    </script>



<link rel="stylesheet" href="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css">


<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="//mirrors.sustech.edu.cn/cdnjs/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>



    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="//www.googletagmanager.com/gtag/js?id=UA-69084811-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-69084811-1');
    </script>





<script>
    function initialTyped () {
        var typedTextEl = $('.typed-text');
        if (typedTextEl && typedTextEl.length > 0) {
            var typed = new Typed('.typed-text', {
                strings: ["Stay Hungry. Stay Foolish.", "常与同好争高下，莫与傻子论短长"],
                typeSpeed: 90,
                loop: true,
                loopCount: Infinity,
                backSpeed: 20,
            });
        }
    }

    if ($('.article-header') && $('.article-header').length) {
        $(document).ready(function () {
            initialTyped();
        });
    }
</script>




</html>
